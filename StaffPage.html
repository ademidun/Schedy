<!DOCTYPE html>
<html>
<style type="text/css">
  button{
    margin: 2%;
  }
  #logoutbutton{
    float:right;
  }
  #logo_out{
    margin: 5px;
    text-align: center;
  }
  #content{
    text-align: center;
    color: black;
    padding: 5px;
  }
  i.traffic-light{
color: #35EA08 !important;
}
i.traffic-medium{
color: #F39B2F !important;
}
i.traffic-heavy{
color: #FF2300 !important;
}
</style>
    <head>
      <title>Schedy - Staff</title>
          
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

      <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
      <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
      <link href="responsive-calendar.css" rel="stylesheet" media="screen">
      <script src="responsive-calendar2.js"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="calendario/css/calendar.css" />
      <link rel="stylesheet" type="text/css" href="calendario/css/custom_2.css" />
      <script src="js/modernizr.custom.63321.js"></script>
      <link rel ="stylesheet" type ="text/css" href="Atila Style.css" />
      <link rel ="stylesheet" type ="text/css" href="calendar-style.css" />
      <link href="responsive-calendar/responsive-calendar.css" rel="stylesheet" media="screen">
      <script src="responsive-calendar/responsive-calendar2.js"></script>
    </head>

    <body>      
      <div id="header">
          <script src="https://cdn.firebase.com/js/client/2.2.9/firebase.js"></script>
            <!--<h1 style="color: black !important">Schedy</h1>-->
            <div id="logo_out">
              <img src="images/schedycal.png" width="300" height="77" align="center">
              <button onclick="logout()" type="button" class="btn btn-primary" id="logoutbutton"> Log out</button>
            </div>
            <p id="date"></p> 
            <ul class="nav nav-pills nav-justified">
              <li class= "headerbar"><a href="about.html">About Us</a></li>
              <li class= "headerbar"></a>
              </li>
              <li class= "headerbar"><a href="index.html">Home <i class="fa fa-home"> </i> </a></li>
              <li class= "headerbar"></li>
              <li class= "headerbar"><a href="contact.html">Contact Us</a></li>
            </ul>
    </div>
    
          <div class="content-calendar">
          <h1> Staff's Schedule </h1>
          </div> <!--   Calendario start -->
                  <div id="custom-inner" class="custom-inner hide">
            <div class="custom-header clearfix hide">
              <nav>
                <span id="custom-prev" class="custom-prev"></span>
                <span id="custom-next" class="custom-next"></span>
              </nav>
              <h2 id="custom-month" class="custom-month">September</h2>
              <h3 id="custom-year" class="custom-year">2015</h3>
            </div>
</div>
            <div id="custom-inner" class="custom-inner hide">
            <div class="custom-header clearfix">
              <nav>
                <span id="custom-prev" class="custom-prev"></span>
                <span id="custom-next" class="custom-next"></span>
              </nav>
              <h2 id="custom-month" class="custom-month"></h2>
              <h3 id="custom-year" class="custom-year"></h3>
            </div>
            <div id="calendar" class="fc-calendar-container"></div>
          </div>
          <div id="content">
            <form class='staff-form'>
                  <p>Pick a date:</p><input type="date" id="dateInput" name="event-date"><br>
                  <p>Start Time:</p> <input type="time" name="event-start" id="startTimeInput">
                  <p>End Time:</p> <input type="time" name="event-end" id="endTimeInput">
                  <p>Course:</p> <input type="text" name="course" id="courseInput">
                  <p>Capacity:</p> <input type="numeric" name="capacity" id="capacityInput">
            </form>
                  <button class="btn btn-primary" style="background-color:#33B5E5;border-color:#33B5E5;margin:2%" onclick="bookAppointment()">Register new office hour</button>
                  
                                    <!--<button class="btn btn-primary btn-calendar" style="background-color:#33B5E5;border-color:#33B5E5;margin:2%"> Check Schedule</button>-->
          </div>
                   
          <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.calendario.js"></script>
    <script type="text/javascript" src="js/data.js"></script>
    <link rel="stylesheet" type="text/css" href="calendario/css/custom_2.css">
    <script>
      var myFirebaseRef = new Firebase("https://schedy.firebaseio.com/");
      var offHoursRef = myFirebaseRef.child("office_hours");

      var authData = myFirebaseRef.getAuth();
      if (authData) {
        console.log("User " + authData.uid + " is logged in with " + authData.provider);
        var userid = authData.uid;
      } else {
        console.log("User is logged out");
      }

      function bookAppointment(){
          var dateIn = $('#dateInput').val();
          var startTimeIn = $('#startTimeInput').val();
          var endTimeIn = $('#endTimeInput').val();
          var courseIn = $('#courseInput').val();
          var capacityIn = $('#capacityInput').val();

          offHoursRef.push({
            start: startTimeIn,
            end: endTimeIn,
            course: courseIn,
            date: dateIn,
            capacity: capacityIn,
            staff_id: userid
          }); 
          var schedulebutton = '<input type="button" value="Check My Schedule"class="btn btn-primary calendar-btn2" style="background-color:#33B5E5;border-color:#33B5E5;margin:2%" onclick="calendarload"></input>';
          $('.staff-form').after(schedulebutton);
          alert('Your new office hour was registered. Thank you!');
              /*any variables which I want to use across multiple files,
     must be declared here, providing them with global scope*/

var codropsEvents = {

  // '09-21-2015' : '<a href="http://tympanus.net/codrops/2012/11/21/adaptive-thumbnail-pile-effect-with-automatic-grouping/">Adaptive Thumbnail Pile Effect with Automatic Grouping</a>',
  // '09-25-2015' : '<span>Christmas Day</span>',
  // '09-31-2015' : '<span>New Year\'s Eve</span>'
};
    var userday, userdayArr, eventStart;
      $('.calendar-btn2').click(function calendarload() {
        var showcal =$('.custom-inner, .custom-header');
        showcal.removeClass('hide');
        userday = $('#dateInput').val();
        userdayArr= userday.split('-');
        userdayArr=userdayArr.reverse();
        userday=userdayArr[1]+ '-'+userdayArr[0]+ '-'+ userdayArr[2];
        eventStart = $('#startTimeInput').val();
        eventStartArr=eventStart.split(':');
        eventEnd = $('#endTimeInput').val();
        eventEndArr=eventEnd.split(':');

//populating my object after it has been created to allow for dynamic inputx
  codropsEvents[userday] = '<h3> You have <span id="studentnumber" class="studentcount"> </span> students today</h3> <a href="http://tympanus.net/codrops/2012/11/23/three-script-updates/">Three Script Updates</a><span class="capacity-marker"></span>';
        var transEndEventNames = {
            'WebkitTransition' : 'webkitTransitionEnd',
            'MozTransition' : 'transitionend',
            'OTransition' : 'oTransitionEnd',
            'msTransition' : 'MSTransitionEnd',
            'transition' : 'transitionend'
          },
          transEndEventName = transEndEventNames[ Modernizr.prefixed( 'transition' ) ],
          $wrapper = $( '#custom-inner' ),
          $calendar = $( '#calendar' ),
          cal = $calendar.calendario( {
            onDayClick : function( $el, $contentEl, dateProperties ) {

              if( $contentEl.length > 0 ) {
                showEvents( $contentEl, dateProperties );
              }

            },
            caldata : codropsEvents,
            displayWeekAbbr : true
          } ),
          $month = $( '#custom-month' ).html( cal.getMonthName() ),
          $year = $( '#custom-year' ).html( cal.getYear() );

        $( '#custom-next' ).on( 'click', function() {
          cal.gotoNextMonth( updateMonthYear );
        } );
        $( '#custom-prev' ).on( 'click', function() {
          cal.gotoPreviousMonth( updateMonthYear );
        } );

        function updateMonthYear() {        
          $month.html( cal.getMonthName() );
          $year.html( cal.getYear() );
        }

        // just an example..
        function showEvents( $contentEl, dateProperties ) {

          hideEvents();
          
          var $events = $( '<div id="custom-content-reveal" class="custom-content-reveal"><h4>Events for ' + dateProperties.monthname + ' ' + dateProperties.day + ', ' + dateProperties.year + '</h4></div>' ),
            $close = $( '<span class="custom-content-close"></span>' ).on( 'click', hideEvents );

          $events.append( $contentEl.html() , $close ).insertAfter( $wrapper );
          
          setTimeout( function() {
            $events.css( 'top', '0%' );
          }, 25 );

        }
        function hideEvents() {

          var $events = $( '#custom-content-reveal' );
          if( $events.length > 0 ) {
            
            $events.css( 'top', '100%' );
            Modernizr.csstransitions ? $events.on( transEndEventName, function() { $( this ).remove(); } ) : $events.remove();

          }

        }
        var duration=eventEndArr[0] - eventStartArr[0];//Obviously will require a better algorithm.
        var capacity=$('#capacityInput').val();
        var capacitylocation =$('.capacity-marker');
        var emptyseats='';
        for(var i=0; i<capacity; i++){//# of circles is based on class time
          seatnumber=(i+1);
          if( 1<=seatnumber && seatnumber<=(0.5*capacity))
        emptyseats+=`<i style=\"color: #35EA08 !important\" class= \"fa fa-circle-o-notch traffic-light\" id=\"seat${seatnumber}\"></i>`;
        else if( (0.5*capacity)<seatnumber && seatnumber<=(capacity-3))
        emptyseats+=`<i style=\"color: #F39B2F !important\"class= \"fa fa-circle-o-notch traffic-medium\" id=\"seat${seatnumber}\"></i>`;
      else if( (capacity-3)<seatnumber)
        emptyseats+=`<i style=\"color: #FF2300 !important\"class= \"fa fa-circle-o-notch traffic-heavy\" id=\"seat${seatnumber}\"></i>`;
      if(seatnumber==capacity)
        $('#studentnumber').append(`<p>${seatnumber}</p>`);
        $('#studentnumber').css("color", "#FF2300" );
    }
          
        capacitylocation.append(emptyseats);
      return false;
      this.preventDefault();
      event.preventDefault();
      });
      }

    </script>
    <script> 

   </script>
         
                
   </body>

    </html>